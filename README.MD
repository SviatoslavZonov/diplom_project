# Дипломный проект профессии «Python-разработчик: расширенный курс»

## Backend-приложение для автоматизации закупок

### Цель дипломного проекта

Создадите и настроите проект по автоматизации закупок в розничной сети, проработаете модели данных, импорт товаров, API views.

Вам нужно:

* разработать backend для сервиса заказа товаров,
* усовершенствовать навыки работы с Django ORM через проработку моделей товаров и связанных сущностей,
* реализовать импорт и экспорт товаров,
* внедрить систему управления заказами,
* оптимизировать методы с использованием асинхронности,
* освоить работу со сторонними библиотеками и фреймворками,
* подготовить документацию к проекту,
* использовать AI инструменты для решения задач.

## Инструкция к работе над проектом

### Общее описание приложения

Приложение предназначено для автоматизации закупок в розничной сети через REST API.

**Пользователи сервиса:**

1. Клиент (покупатель):

- делает ежедневные закупки по каталогу, в котором представлены товары от нескольких поставщиков,
- в одном заказе можно указать товары от разных поставщиков,
- пользователь может авторизироваться, регистрироваться и восстанавливать пароль через API.
    
2. Поставщик:

- через API информирует сервис об обновлении прайса,
- может включать и отключать приём заказов,
- может получать список оформленных заказов (с товарами из его прайса).

### Задача

Необходимо разработать backend-часть сервиса заказа товаров для розничных сетей на Django Rest Framework.

**Базовая часть:**
* разработка сервиса под готовую спецификацию (API),
* возможность добавления настраиваемых полей (характеристик) товаров,
* импорт товаров,
* отправка накладной на email администратора (для исполнения заказа),
* отправка заказа на email клиента (подтверждение приёма заказа).

**Продвинутая часть (необязательная к выполнению, не влияет на получение зачёта):**
* экспорт товаров,
* админка заказов (проставление статуса заказа и уведомление клиента),
* выделение медленных методов в отдельные асинхронные функции (email, импорт, экспорт).


## Этапы разработки
**Критерии достижения**

### Этап 1. Создание и настройка проекта
1. Вы имеете актуальный код данного репозитория на рабочем компьютере.
2. У вас создан Django-проект, и он запускается без ошибок.

### Этап 2. Проработка моделей данных
1. Созданы модели и их дополнительные методы.

### Этап 3. Реализация импорта товаров
1. Созданы функции загрузки товаров из приложенных файлов в модели Django.
2. Загружены товары из всех файлов для импорта.

### Этап 4. Реализация APIViews
1. Реализованы API Views для основных страниц и сервиса (без админки):
   - Авторизация
   - Регистрация
   - Получение списка товаров
   - Получение спецификации по отдельному товару в базе данных
   - Работа с корзиной (добавление, удаление товаров)
   - Добавление/удаление адреса доставки
   - Подтверждение заказа
   - Отправка email c подтверждением
   - Получение  списка заказов
   - Получение деталей заказа
   - Редактирование статуса заказа

### Этап 5. Полностью готовый backend
1. Полностью работающие API Endpoint'ы
2. Корректно отрабатывает следующий сценарий:
   - пользователь может авторизироваться,
   - есть возможность отправки данных для регистрации и получения email с подтверждением регистрации,
   - пользователь может добавлять в корзину товары от разных магазинов,
   - пользователь может подтверждать заказ с вводом адреса доставки,
   - пользователь получает email с подтверждением после ввода адреса доставки,
   - пользователь может переходить на страницу «Заказы» и открывать созданный заказ.

## Продвинутая часть (выполняется по желанию, не влияет на получение зачёта)
Обязательное условие: базовая часть проекта полностью готова.

### Этап 6. Реализация API views админки склада
1. Реализованы API views для страниц админки сервиса.

### Этап 7. Вынос медленных методов в задачи Celery
1. Создано Celery-приложение c методами:
   - send_email,
   - do_import.
2. Создан view для запуска Celery-задачи do_import из админки.

### Этап 8. Создание docker-compose файла для приложения
1. Создать docker-compose файл для сборки приложения.
2. Предоставить инструкцию для сборки docker-образа.


# Инструкция по настройке и запуску проекта

## Этап 1. Создание и настройка проекта

1. Клонирование репозитория (при проверке)
git clone git clone https://github.com/SviatoslavZonov/diplom_project.git 
cd diplom_project

2. Установка зависимостей
pip install django djangorestframework django-filter celery

3. Создайте новый Django-проект и приложение (при создании нового):
django-admin startproject myproject
cd myproject  # Переход в папку проекта
python manage.py startapp app  # Создание приложения "app"

4. Настройка виртуального окружения
python -m venv venv
source venv/bin/activate  # Linux/MacOS

py -m venv venv            # Windows
venv\Scripts\activate     

5. Установка пакетов
pip install -r requirements.txt  # Если файл существует или создайте requirements.txt с зависимостями

6. Запуск сервера разработки
python manage.py runserver
Проверка: Откройте http://localhost:8000

## Этап 2. Проработка моделей данных

1. Создание миграций
python manage.py makemigrations

2. Применение миграций
python manage.py migrate

3. Проверка моделей
Убедиться, что в приложении app определены модели:
Supplier (поставщики)
Product (товары)
Cart (корзина)
Order (заказы)
Contact (контакты)

## Этап 3. Реализация импорта товаров

1. Подготовка данных
- Создайте папку data в корне проекта
- Разместите YAML-файл с товарами по примеру:
products:
  - name: "Ноутбук ASUS VivoBook"
    supplier: "TechSupplier"
    price: 899.99
    quantity: 15
    characteristics:
      processor: "Intel Core i5"
      ram: "8 GB"

2. Запуск импорта
python manage.py import_products

3. Проверка данных
Зайдите в Django Admin (http://localhost:8000/admin)
Убедитесь, что:
- Поставщики созданы
- Товары загружены
- Характеристики отображаются корректно

Дополнительные команды: 

|  Действие	                   |  Команда  |
| :---                         |  :---  |
|  Создать суперпользователя	 |  python manage.py createsuperuser  |
|  Очистить базу данных	       |  python manage.py flush  |
|  Запустить тесты	          |  python manage.py test app  |

Для получения справки по командам:

python manage.py help
python manage.py import_products --help

При ошибках: Удалите db.sqlite3 и файлы в папке app/migrations, заново проведите миграцию:

python manage.py makemigrations
python manage.py migrate
python manage.py import_products

## Этап 4. Реализация APIViews
Пропишем код всем заявленным критериям:
- Авторизация - реализована через LoginView (JWT токены)
- Регистрация - реализована через RegisterView
- Получение списка товаров - через ProductViewSet
- Получение спецификации по товару - через ProductViewSet
- Работа с корзиной - полный CRUD через CartViewSet
- Добавление/удаление адреса доставки - через ContactViewSet
- Подтверждение заказа - через confirm action в OrderViewSet 
- Отправка email с подтверждением - реализованы 3 метода отправки email
- Получение списка заказов - через OrderViewSet и OrderHistoryView
- Получение деталей заказа - через OrderViewSet
- Редактирование статуса заказа - через update_status action

Дополнительные возможности реализации:
- Использование JWT для аутентификации
- Фильтрация и поиск для товаров
- Автоматический расчет общей суммы заказа
- Раздельные методы для разных типов email-уведомлений
- Проверка прав для всех критических операций

## Этап 5. Полностью готовый backend
1. Полностью работающие API Endpoints

| Эндпоинт	                |  Метод	         |  Описание                                                          	| Статус |
| :---                      |     :---:         | :---                                | :---  |                                                   
| /api/auth/register/	    |     POST	         |  Регистрация пользователя. Возвращает JWT-токены.	                   |   Работает  |
| /api/auth/login/	       |     POST	         |  Авторизация пользователя. Возвращает JWT-токены.	                   |   Работает  |
| /api/products/	          |     GET	         |  Получение списка товаров с фильтрацией (supplier, price) и поиском.	 |   Работает  |
| /api/cart/	             |     GET	         |  Просмотр корзины текущего пользователя.	                            |   Работает  |
| /api/cart/	             |     POST	         |  Добавление товара в корзину.	                                        |   Работает  |
| /api/cart/{id}/	          |     PUT/DELETE	   |  Изменение/удаление товара в корзине.	                               |   Работает  |
| /api/contacts/	          |     GET/POST	   |  Просмотр/создание контактов (адресов доставки).	                      |   Работает  |
| /api/contacts/{id}/	    |     PUT/DELETE	   |  Изменение/удаление контакта.	                                        |   Работает  |
| /api/orders/	             |     POST	         |  Создание заказа. Очищает корзину и отправляет email с подтверждением. |	  Работает  |
| /api/orders/{id}/confirm/ |	    POST	         |  Подтверждение заказа (меняет статус на processing).	                |   Работает  |
| /api/orders/history/	    |     GET	         |  Получение истории заказов пользователя.	                            |   Работает  |

2. Корректная работа сценариев:
 
| Сценарий	                                          |    Статус	    |    Комментарии  |
| :---                                                |     :---:     | :---                                |                    
| Авторизация	                                       |   Работает	 | JWT-токены возвращаются корректно.  |
| Регистрация	                                       |   Работает    | Email с подтверждением регистрации отправляется.  |
| Добавление товаров в корзину от разных поставщиков	|   Работает	 | Товары добавляются, уникальность контролируется (unique_together в модели).  |
| Создание контактов (адресов доставки)	            |   Работает	 | Контакты сохраняются и привязываются к пользователю.  |
| Подтверждение заказа	                              |   Работает	 | Статус заказа меняется на processing, отправляется email.  |
| Получение email после подтверждения заказа	         |   Работает	 | Письма отправляются при создании и изменении статуса заказа.  |
| Получение списка заказов	                           |   Работает	 | Эндпоинт /api/orders/history/ возвращает историю заказов.  |

Провести тестирование через Postman:
Регистрация → Авторизация → Добавление товаров → Создание контакта → Подтверждение заказа → Проверка истории заказов.

Примеры запросов с описанием в файле [requests-examples.http](./app/requests-examples.http).

## Этап 6. Реализация API views админки склада
Реализованы API views для страниц админки сервиса.

## Этап 7. Вынос медленных методов в задачи Celery
1. Создано Celery-приложение c методами:
   - send_email,
   - do_import.
2. Создан view для запуска Celery-задачи do_import из админки.

Установите celery и redis: 
pip install celery redis

Запустите Redis:
redis-server

Запустите Celery worker:
celery -A config worker --loglevel=info

Запустите Django:
python manage.py runserver

Проверка:
Отправьте тестовый заказ → проверьте логи Celery (должно быть Task send_email succeeded).
Запустите импорт через API → в логах Celery появится Task do_import succeeded.


# Коммиты оставляю поэтапно в Git, параллельно с доработкой и исправлениями в readme.md

## Требования
 ОС Linux, MacOS, Windows 10
Python 3.8+
Django 4.2+
Поддерживаемые СУБД: SQLite/PostgreSQL/MySQL